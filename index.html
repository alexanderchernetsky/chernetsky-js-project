<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <title>racing game project</title>
  </head>
  <body>
    <div class="canvas-wrapper"></div>
    <script>
      'use strict';
      // constants
      var GAMEAREAWIDTH = 500; // px width of our game area
      var GAMEAREAHEIGHT = 600; // px height of our game area
      var PLAYERCARWIDTH = 40; // px width of user car
      var PLAYERCARHEIGHT = 80; // px height of user car
      var OBSTACLEWIDTH = 200; // px width of obstacle
      var OBSTACLEHEIGHT = 20; // px height of obstacle

      var playerCar; // declare variable of user car
      var obstacle; // declare variable for our obstacles

      // game area object
      var myGameArea = {
        canvas : document.createElement("canvas"),
        start : function() {
          this.canvas.width = GAMEAREAWIDTH;
          this.canvas.height = GAMEAREAHEIGHT;
          this.context = this.canvas.getContext("2d");
          document.querySelector('.canvas-wrapper').appendChild(this.canvas);
        },
        clear: function () {
          this.context.clearRect(0 , 0, GAMEAREAWIDTH, GAMEAREAHEIGHT);
        }
      };

      // creating empty game area canvas with car-rectangle and obstacle-rectangle
      (function startGame() {
        myGameArea.start();
        playerCar = new PlayerCar(PLAYERCARWIDTH, PLAYERCARHEIGHT, 230, 500);
        obstacle = new Obstacle(OBSTACLEWIDTH, OBSTACLEHEIGHT, 0 , 200);
      }());

      // constructor for player car
       function PlayerCar (width, height, x, y) {
         var self = this;
         self.width = width;
         self.height = height;
         self.posX = x;
         self.posY = y;
         self.speedX = 0;
         self.speedY = 0;
         self.update = function () {
           var ctx = myGameArea.context;
           ctx.fillStyle = 'red';
           ctx.fillRect(self.posX, self.posY, self.width, self.height);
         };
         self.changePos = function () {
           self.posX += self.speedX;
           self.posY += self.speedY;
         };
         self.crashWith = function (obstacleObj) {
           var myBottom = self.posY + self.height;
           var myTop = self.posY;
           var myRight = self.posX + self.width;
           var myLeft = self.posX;
           var obstacleBottom = obstacleObj.posY + obstacleObj.height;
           var obstacleTop = obstacleObj.posY;
           var obstacleRight = obstacleObj.posX + obstacleObj.width;
           var obstacleLeft = obstacleObj.posX;
           var crash = false;
           if((myTop < obstacleBottom) && (myBottom > obstacleTop)) {
             if ((myRight > obstacleLeft) && (myLeft < obstacleRight)) {
               crash = true;
             }
           }
           return crash;
         }
       }

      // constructor for obstacles
      function Obstacle (width, height, x, y) {
        var self = this;
        self.width = width;
        self.height = height;
        self.posX = x;
        self.posY = y;
        self.speedX = 0;
        self.speedY = 0;
        self.update = function () {
          var ctx = myGameArea.context;
          ctx.fillStyle = 'green';
          ctx.fillRect(self.posX, self.posY, self.width, self.height);
        };
        self.changePos = function () {
          self.posX += self.speedX;
          self.posY += self.speedY;
        }
      }

       window.addEventListener('keydown', moveCar, false);
       window.addEventListener('keyup', stopCar, false);

       // functions for control our car using keypad arrow keys
       // to move car
       function moveCar(EO) {
         EO = EO || window.event;
         EO.preventDefault();
         switch (EO.which) {
           case 37:
             playerCar.speedX = -1;
             break;
           case 39:
             playerCar.speedX = 1;
             break;
           case 40:
             playerCar.speedY = 1;
             break;
           case 38:
             playerCar.speedY = -1;
             break;
           default:
             break;
         }
       }

       // to stop car
       function stopCar(EO) {
         EO = EO || window.event;
         EO.preventDefault();
         switch (EO.which) {
           case 39:
           case 37:
             playerCar.speedX = 0;
             break;
           case 40:
           case 38:
             playerCar.speedY = 0;
             break;
           default:
             break;
         }
       }

       // update of our game field
       requestAnimationFrame(updateGameArea);

       function updateGameArea() {
         if (playerCar.crashWith(obstacle)) {
           cancelAnimationFrame(updateGameArea);
         } else {
           myGameArea.clear();
           obstacle.update();
           playerCar.changePos();
           playerCar.update();
           requestAnimationFrame(updateGameArea);
         }
       }

    </script>
  </body>
</html>